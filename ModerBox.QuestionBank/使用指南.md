# 题库转换功能使用指南

## 快速开始

### 1. 构建项目

```powershell
dotnet build d:\WorkSpace\CSharp\ModerBox\ModerBox.sln
```

### 2. 运行应用程序

```powershell
dotnet run --project d:\WorkSpace\CSharp\ModerBox\ModerBox\ModerBox.csproj
```

### 3. 使用题库转换功能

1. 在应用程序左侧导航栏中点击"题库转换"
2. 使用提供的示例题库文件测试功能：
   - 示例文件位置：`d:\WorkSpace\CSharp\ModerBox\tmp\示例题库.txt`
3. 选择目标格式（考试宝、磨题帮、小包搜题 Excel、小包搜题 TXT）
4. 点击"开始转换"

## 测试示例题库

项目包含一个示例题库文件：`tmp\示例题库.txt`

该文件包含：
- 2道单选题
- 2道多选题
- 3道判断题

您可以使用这个文件测试转换功能。

## 运行单元测试

```powershell
# 运行所有测试
dotnet test d:\WorkSpace\CSharp\ModerBox\ModerBox.sln

# 只运行题库转换的测试
dotnet test d:\WorkSpace\CSharp\ModerBox\ModerBox.QuestionBank.Test\ModerBox.QuestionBank.Test.csproj
```

## 功能验证清单

- ✅ 项目成功编译
- ✅ 所有单元测试通过
- ✅ UI界面正确集成
- ✅ 导航菜单显示"题库转换"项
- ✅ 支持多种文件格式
- ✅ 自动编码检测
- ✅ 文件选择对话框工作正常
- ✅ 转换完成后自动打开文件夹

## 代码结构

```
ModerBox/
├── ModerBox.QuestionBank/              # 核心业务逻辑
│   ├── Question.cs                     # 题目模型
│   ├── TxtReader.cs                    # TXT读取器
│   ├── ExcelReader.cs                  # Excel读取器
│   ├── QuestionBankWriter.cs           # 导出器
│   └── README.md                       # 项目文档
│
├── ModerBox.QuestionBank.Test/         # 单元测试
│   └── QuestionBankTests.cs
│
└── ModerBox/                           # 主UI项目
    ├── ViewModels/
    │   └── QuestionBankConversionViewModel.cs
    └── Views/UserControls/
        ├── QuestionBankConversion.axaml
        └── QuestionBankConversion.axaml.cs
```

## 支持的题库格式

### 输入格式

| 格式 | 说明 | 文件类型 |
|------|------|----------|
| TXT文本 | Word转换的文本文件 | .txt |
| 网络大学Excel | 标准格式 | .xlsx, .xls |
| 网络大学4列 | 简化格式 | .xlsx, .xls |
| EXC格式 | 特定格式 | .xlsx, .xls |
| 简单 Excel | 5列（专业、题型、题目、选项、正确答案） | .xlsx, .xls |
| 国电培训 JSON | 国电培训系统导出的JSON | .json |

### 输出格式

| 格式 | 说明 | 文件类型 |
|------|------|----------|
| 考试宝 | 考试宝App格式 | .xlsx |
| 磨题帮 | 磨题帮App格式 | .xlsx |
| 小包搜题 Excel | 第一列题干，第二列答案，第三列起为选项 | .xlsx |
| 小包搜题 TXT | 每行一个JSON（q/a/ans） | .txt |

## 简单 Excel（5列）格式说明

- 表头必须为：`专业`、`题型`、`题目`、`选项`、`正确答案`
- 选项列用英文逗号分隔，格式如：`A. 选项1,B. 选项2,C. 选项3`
- 答案列可写为：`A. 选项1` 或 `A. 选项1,C. 选项3`
- 系统会自动从答案列中提取字母（如 `A` 或 `ACD`）

## 技术细节

### 依赖项
- **ClosedXML**: Excel文件处理
- **System.Text.Encoding.CodePages**: 编码支持

### 编码支持
自动检测以下编码：
- UTF-8 (with/without BOM)
- UTF-16 (LE/BE)
- GB2312
- 其他系统编码

### 题型识别
- 使用正则表达式识别题型标记
- 自动分离题干、选项、答案
- 支持多种答案格式

## 故障排除

### 如果遇到编译错误
1. 确保安装了.NET 9.0 SDK
2. 运行 `dotnet restore`
3. 清理并重新构建：`dotnet clean && dotnet build`

### 如果UI不显示
1. 检查MainWindowViewModel是否包含QuestionBankConversionViewModel
2. 检查MainWindow.axaml是否包含DataTemplate
3. 重新构建项目

### 如果转换失败
1. 检查源文件格式是否正确
2. 尝试使用"自动检测"源格式
3. 查看状态栏的错误信息

## 扩展建议

如果需要添加新的题库格式：

1. 在`ModerBox.QuestionBank`中添加新的Reader类
2. 在`QuestionBankConversionViewModel`中添加格式选项
3. 更新UI的ComboBox选项
4. 添加相应的单元测试

## 联系方式

如有问题或建议，请参考项目的主README文件。
