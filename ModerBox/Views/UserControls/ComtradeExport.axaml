<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="using:ModerBox.ViewModels"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
             x:DataType="vm:ComtradeExportViewModel"
             x:Class="ModerBox.Views.UserControls.ComtradeExport">
    <Design.DataContext>
        <vm:ComtradeExportViewModel/>
    </Design.DataContext>
    
    <Grid Margin="20" RowDefinitions="Auto,Auto,*,Auto,Auto">
        <!-- 文件选择区域 -->
        <StackPanel Grid.Row="0">
            <TextBlock Margin="0 5" Text="源波形文件"/>
            <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0" Margin="5" Watermark="选择 .cfg 文件" Text="{Binding SourceFile}" IsReadOnly="True"/>
                <Button Grid.Column="1" Margin="5" Content="..." Command="{Binding SelectSourceFile}"/>
            </Grid>
            
            <TextBlock Margin="0 5" Text="输出文件路径"/>
            <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0" Margin="5" Watermark="选择保存位置" Text="{Binding TargetFile}"/>
                <Button Grid.Column="1" Margin="5" Content="..." Command="{Binding SelectTargetFile}"/>
            </Grid>
            
            <!-- 导出选项 -->
            <Grid ColumnDefinitions="*,*" Margin="0 10">
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Margin="5" Text="站名:"/>
                    <TextBox Width="120" Margin="5" Text="{Binding StationName}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Margin="5" Text="设备ID:"/>
                    <TextBox Width="120" Margin="5" Text="{Binding DeviceId}"/>
                </StackPanel>
            </Grid>
            
            <StackPanel Orientation="Horizontal" Margin="0 5">
                <TextBlock VerticalAlignment="Center" Margin="5" Text="输出格式:"/>
                <RadioButton Margin="10 0" Content="ASCII" IsChecked="{Binding UseAsciiFormat}"/>
                <RadioButton Margin="10 0" Content="BINARY" IsChecked="{Binding !UseAsciiFormat}"/>
            </StackPanel>
        </StackPanel>
        
        <Separator Grid.Row="1" Margin="0 10"/>
        
        <!-- 通道选择区域 -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" IsVisible="{Binding IsFileLoaded}">
            <!-- 模拟量通道列表 -->
            <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Margin="5" Padding="10">
                <Grid RowDefinitions="Auto,Auto,*">
                    <TextBlock Grid.Row="0" FontWeight="Bold" Text="模拟量通道" Margin="0 0 0 5"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0 5">
                        <Button Content="全选" Command="{Binding SelectAllAnalog}" Margin="0 0 5 0" Padding="8 4"/>
                        <Button Content="全不选" Command="{Binding DeselectAllAnalog}" Padding="8 4"/>
                    </StackPanel>
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding AnalogChannels}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:ChannelItemViewModel}">
                                    <Border BorderBrush="LightGray" BorderThickness="0 0 0 1" Padding="5">
                                        <Grid ColumnDefinitions="Auto,*,*">
                                            <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding DisplayName}" VerticalAlignment="Center" Margin="5 0"/>
                                            <TextBox Grid.Column="2" Text="{Binding NewName}" Watermark="新名称" Margin="5 2" IsEnabled="{Binding IsSelected}"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
            
            <!-- 数字量通道列表 -->
            <Border Grid.Column="1" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Margin="5" Padding="10">
                <Grid RowDefinitions="Auto,Auto,*">
                    <TextBlock Grid.Row="0" FontWeight="Bold" Text="数字量通道" Margin="0 0 0 5"/>
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0 5">
                        <Button Content="全选" Command="{Binding SelectAllDigital}" Margin="0 0 5 0" Padding="8 4"/>
                        <Button Content="全不选" Command="{Binding DeselectAllDigital}" Padding="8 4"/>
                    </StackPanel>
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding DigitalChannels}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type vm:ChannelItemViewModel}">
                                    <Border BorderBrush="LightGray" BorderThickness="0 0 0 1" Padding="5">
                                        <Grid ColumnDefinitions="Auto,*,*">
                                            <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding DisplayName}" VerticalAlignment="Center" Margin="5 0"/>
                                            <TextBox Grid.Column="2" Text="{Binding NewName}" Watermark="新名称" Margin="5 2" IsEnabled="{Binding IsSelected}"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
        
        <!-- 未加载文件时的提示 -->
        <Border Grid.Row="2" IsVisible="{Binding !IsFileLoaded}" 
                HorizontalAlignment="Center" VerticalAlignment="Center">
            <TextBlock Text="请先选择源波形文件以加载通道列表" 
                       Foreground="Gray" FontSize="16"/>
        </Border>
        
        <!-- 状态和按钮区域 -->
        <Separator Grid.Row="3" Margin="0 10"/>
        
        <Grid Grid.Row="4" RowDefinitions="Auto,Auto">
            <TextBlock Grid.Row="0" Text="{Binding StatusMessage}" Margin="5" 
                       Foreground="DarkBlue" TextWrapping="Wrap"/>
            <Button Grid.Row="1" Content="开始导出" Command="{Binding RunExport}" 
                    HorizontalAlignment="Stretch" Margin="5" Padding="10"
                    IsEnabled="{Binding !IsLoading}"/>
        </Grid>
    </Grid>
</UserControl>
