<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ModerBox.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:DataType="vm:ChannelDifferenceAnalysisViewModel"
             x:Class="ModerBox.Views.UserControls.ChannelDifferenceAnalysis">
    <Design.DataContext>
        <vm:ChannelDifferenceAnalysisViewModel/>
    </Design.DataContext>

    <ScrollViewer>
        <StackPanel Margin="20" Spacing="15">
            <!-- 标题和说明 -->
            <StackPanel Spacing="5">
                <TextBlock FontSize="18" FontWeight="Bold" Text="通道差值分析"/>
                <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                          Text="此功能用于扫描波形文件，匹配IDEL1_ABS、IDEL2_ABS、IDEE1_SW、IDEE2_SW通道，并计算差值导出到Excel"/>
            </StackPanel>

            <!-- 源文件夹选择 -->
            <StackPanel Spacing="5">
                <TextBlock Text="波形文件夹路径" FontWeight="SemiBold"/>
                <Grid ColumnDefinitions="*,Auto">
                    <TextBox Grid.Column="0" 
                            Text="{Binding SourceFolder}" 
                            Watermark="选择包含波形文件的文件夹"
                            IsReadOnly="True"/>
                    <Button Grid.Column="1" 
                           Content="浏览..." 
                           Margin="5,0,0,0"
                           Command="{Binding SelectSource}"/>
                </Grid>
            </StackPanel>

            <!-- 输出文件选择 -->
            <StackPanel Spacing="5">
                <TextBlock Text="输出Excel文件路径" FontWeight="SemiBold"/>
                <Grid ColumnDefinitions="*,Auto">
                    <TextBox Grid.Column="0" 
                            Text="{Binding TargetFile}" 
                            Watermark="选择Excel结果文件保存位置"
                            IsReadOnly="True"/>
                    <Button Grid.Column="1" 
                           Content="浏览..." 
                           Margin="5,0,0,0"
                           Command="{Binding SelectTarget}"/>
                </Grid>
            </StackPanel>

            <!-- 说明信息 -->
            <StackPanel Spacing="5">
                <TextBlock Text="处理说明" FontWeight="SemiBold"/>
                <Border Background="LightBlue" 
                       Padding="10" 
                       CornerRadius="5">
                    <TextBlock TextWrapping="Wrap" FontSize="12"
                              Text="系统将自动扫描选定文件夹下的所有Comtrade波形文件（*.cfg），查找包含IDEL1、IDEL2、IDEE1、IDEE2四个通道的文件进行分析。"/>
                </Border>
            </StackPanel>

            <!-- 操作按钮 -->
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="开始分析" 
                       Command="{Binding RunAnalysis}"
                       IsEnabled="{Binding !IsRunning}"
                       Background="DodgerBlue"
                       Foreground="White"
                       Padding="20,8"/>
                <Button Content="重置" 
                       Command="{Binding Reset}"
                       IsEnabled="{Binding !IsRunning}"
                       Padding="15,8"/>
            </StackPanel>

            <!-- 进度条 -->
            <StackPanel Spacing="5">
                <TextBlock Text="处理进度" FontWeight="SemiBold"/>
                <ProgressBar Height="20"
                           Minimum="0" 
                           Maximum="{Binding ProgressMax}" 
                           Value="{Binding Progress}"
                           ShowProgressText="True"/>
            </StackPanel>

            <!-- 状态消息 -->
            <StackPanel Spacing="5">
                <TextBlock Text="状态信息" FontWeight="SemiBold"/>
                <Border Background="LightGray" 
                       Padding="10" 
                       CornerRadius="5">
                    <TextBlock Text="{Binding StatusMessage}" 
                              TextWrapping="Wrap"
                              FontFamily="Consolas"/>
                </Border>
            </StackPanel>

            <!-- 使用说明 -->
            <Expander Header="使用说明" IsExpanded="False">
                <StackPanel Spacing="8" Margin="0,10,0,0">
                    <TextBlock FontWeight="SemiBold" Text="功能说明："/>
                    <TextBlock TextWrapping="Wrap" Text="• 自动扫描指定文件夹下的所有Comtrade波形文件"/>
                    <TextBlock TextWrapping="Wrap" Text="• 自动查找包含IDEL1、IDEL2、IDEE1、IDEE2四个通道的文件"/>
                    <TextBlock TextWrapping="Wrap" Text="• 计算IDEL1-IDEE1和IDEL2-IDEE2差值"/>
                    <TextBlock TextWrapping="Wrap" Text="• 计算(IDEL1-IDEE1)-(IDEL2-IDEE2)和差值百分比"/>
                    <TextBlock TextWrapping="Wrap" Text="• 将结果导出到Excel表格，每个数据点一行"/>
                    
                    <TextBlock FontWeight="SemiBold" Text="输出格式：" Margin="0,10,0,0"/>
                    <TextBlock TextWrapping="Wrap" Text="Excel文件包含：文件名、点序号、原始通道值、基础差值、差值的差值、差值百分比"/>
                    
                    <TextBlock FontWeight="SemiBold" Text="注意事项：" Margin="0,10,0,0"/>
                    <TextBlock TextWrapping="Wrap" Text="• 只有包含所需四个通道的文件才会被处理"/>
                    <TextBlock TextWrapping="Wrap" Text="• 支持.cfg/.dat格式的Comtrade波形文件"/>
                    <TextBlock TextWrapping="Wrap" Text="• 处理大量文件时可能需要较长时间"/>
                    <TextBlock TextWrapping="Wrap" Text="• 会递归搜索子文件夹中的波形文件"/>
                </StackPanel>
            </Expander>
        </StackPanel>
    </ScrollViewer>
</UserControl> 